# Director v2 テスト結果レポート

## 実行日時
2026-01-01 09:20:39

## テスト結果サマリ
- 総テスト数: 18
- 成功: 18
- 失敗: 0
- スキップ: 0

## 詳細結果

### テスト1: _is_vague_hook() のテスト
| テストケース | 入力 | 期待値 | 結果 |
|-------------|------|--------|------|
| 曖昧語のみ（短い） | `雰囲気` | True | ✅ |
| 曖昧語のみ | `なんか違う` | True | ✅ |
| 曖昧語 + 具体名詞 | `雰囲気がいい屋台` | False | ✅ |
| 具体名詞のみ | `金色の屋根` | False | ✅ |
| 具体名詞のみ | `池の鯉` | False | ✅ |
| 曖昧語のみ | `なんかいい感じ` | True | ✅ |
| 12文字以下の曖昧語 | `ちょっと違う気がする` | True | ✅ |
| 空文字 | `""` | False | ✅ |
| None | `None` | False | ✅ |

### テスト2: _validate_director_output() のテスト
| テストケース | ターン | 期待値 | 結果 | 強制理由 |
|-------------|--------|--------|------|----------|
| 導入フェーズの曖昧発言 | 1 | NOOP | ✅ | 介入根拠なし |
| 導入フェーズでRETRY | 1 | INTERVENE | ✅ | - |
| 中盤の具体的なフック | 4 | INTERVENE | ✅ | - |
| 曖昧語＋具体名詞 | 4 | INTERVENE | ✅ | - |
| 演技指導が含まれる | 4 | NOOP | ✅ | 演技指導ワード検出（絶対禁止） |
| 要注意ワード＋根拠あり | 4 | INTERVENE | ✅ | - |
| 要注意ワード＋根拠なし | 4 | NOOP | ✅ | 介入根拠なし |
| INTERVENEだが根拠なし | 4 | NOOP | ✅ | 介入根拠なし |
| スキーマ補正（actionなし） | 4 | NOOP | ✅ | - |

### テスト3: 成功基準シミュレーション
| 指標 | 目標 | 実績 | 結果 |
|------|------|------|------|
| 導入（SETUP）NOOP率 | ≥80% | 100% | ✅ 達成 |
| 曖昧語誤爆率 | ≤10% | 0% | ✅ 達成 |
| 演技指導検出率 | 100% | 100% | ✅ 達成 |

## 検証された機能

### 1. 導入フェーズ保護
- ターン1-2でPASS+INTERVENEは自動的にNOOPに変換
- RETRY/MODIFY時は介入を許可（重大な逸脱への対応）

### 2. 曖昧語フック検出
- 曖昧語のみのフック（「雰囲気」「なんか」等）を検出
- 具体名詞を含む場合は誤爆しない（「雰囲気がいい屋台」等）

### 3. 演技指導ワード検出
- 絶対禁止ワード（「焦燥感」「ドキドキ」「口調で」等）を100%検出
- 検出時は強制的にNOOPに変換

### 4. 根拠なしINTERVENE抑制
- evidence.dialogue/frameが両方nullの場合、INTERVENEを強制NOOP

### 5. スキーマ補正（後方互換性）
- `action`がない場合はNOOPに補正
- 空文字列はnullに補正

## 結論

✅ **Director v2 は設計通りに動作しています。**

すべてのテストケースが期待通りの結果を返し、誤爆防止機構が正常に機能することが確認されました。
