# ã‚ªãƒ¼ãƒŠãƒ¼ä»‹å…¥æ©Ÿèƒ½ è¨­è¨ˆæ›¸

## 1. æ¦‚è¦

### 1.1 ç›®çš„
å¯¾è©±ãŒæ¨ªé“ã«ãã‚ŒãŸéš›ã«ã€ã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ãŒä»‹å…¥ã—ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’é€šã˜ã¦è»Œé“ä¿®æ­£ã§ãã‚‹æ©Ÿèƒ½ã€‚

### 1.2 ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

| ã‚±ãƒ¼ã‚¹ | çŠ¶æ³ | ã‚ªãƒ¼ãƒŠãƒ¼ã®ä»‹å…¥ |
|--------|------|---------------|
| è©±é¡Œé€¸è„± | ã‚«ãƒ¼ãƒ–ã®è©±ã‚’ã—ã¦ã„ãŸã®ã«ã‚»ãƒ³ã‚µãƒ¼ã®è©±ã¸ | ã€Œã‚«ãƒ¼ãƒ–ã®è©±ã«æˆ»ã—ã¦ã€ |
| æ·±æ˜ã‚Šè¦æ±‚ | é¢ç™½ã„è©±é¡ŒãŒå‡ºãŸã®ã§æ˜ã‚Šä¸‹ã’ãŸã„ | ã€Œä»Šã®ã€‡ã€‡ã«ã¤ã„ã¦ã‚‚ã£ã¨è©±ã—ã¦ã€ |
| æƒ…å ±è£œè¶³ | ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒçŸ¥ã‚‰ãªã„æƒ…å ±ã‚’è¿½åŠ  | ã€Œå®Ÿã¯æ˜¨æ—¥ã®ãƒ­ã‚°ã§ã¯â–³â–³ã ã£ãŸã€ |
| é›°å›²æ°—å¤‰æ›´ | çœŸé¢ç›®ã™ãã‚‹/ãµã–ã‘ã™ã | ã€Œã‚‚ã†å°‘ã—ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦ã€ |
| ç‰¹å®šã‚­ãƒ£ãƒ©æŒ‡å | ç‰¹å®šã®ã‚­ãƒ£ãƒ©ã«è©±ã•ã›ãŸã„ | ã€Œã‚ã‚†ã®è¦‹è§£ã‚’èããŸã„ã€ |

### 1.3 è¨­è¨ˆåŸå‰‡

| åŸå‰‡ | å†…å®¹ |
|------|------|
| è‡ªç„¶ãªæµã‚Œ | ã‚ªãƒ¼ãƒŠãƒ¼æŒ‡ç¤ºã‚’ã€Œå°æœ¬ã®æŒ‡ç¤ºã€ã¨ã—ã¦è‡ªç„¶ã«åæ˜  |
| ã‚­ãƒ£ãƒ©ç¶­æŒ | ä»‹å…¥å¾Œã‚‚ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ€§ã‚’ä¿ã¤ |
| åŒæ–¹å‘æ€§ | ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‹ã‚‰ã‚ªãƒ¼ãƒŠãƒ¼ã¸ã®é€†è³ªå•ã‚’è¨±å®¹ |
| æœ€å°ä»‹å…¥ | å¿…è¦æœ€å°é™ã®ä»‹å…¥ã§åŠ¹æœã‚’å‡ºã™ |

---

## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ã‚ªãƒ¼ãƒŠãƒ¼ä»‹å…¥ã‚·ã‚¹ãƒ†ãƒ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ã€é€šå¸¸çŠ¶æ…‹: RUNNINGã€‘                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚  ã‚„ãª   â”‚ â†â”€â”€â”€â”€â†’ â”‚  ã‚ã‚†   â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚        â†‘                  â†‘                                    â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                 â”‚                                               â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚           â”‚ ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ â”‚                                      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                 â”‚                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                 â”‚ [Pause Button]                                â”‚
â”‚                 â–¼                                               â”‚
â”‚  ã€ä»‹å…¥çŠ¶æ…‹: PAUSEDã€‘                                           â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚           â”‚ InterventionManager â”‚                              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                 â”‚                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚    â–¼            â–¼            â–¼                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚ â”‚WAITINGâ”‚  â”‚PROCESSINGâ”‚  â”‚QUERY_BACKâ”‚                          â”‚
â”‚ â”‚å…¥åŠ›å¾…ã¡â”‚  â”‚æŒ‡ç¤ºè§£é‡ˆä¸­ â”‚  â”‚é€†è³ªå•ä¸­  â”‚                          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚    â”‚            â”‚            â”‚                                 â”‚
â”‚    â”‚ [Send]     â”‚            â”‚ [Answer]                        â”‚
â”‚    â–¼            â–¼            â–¼                                 â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚           â”‚ ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ â”‚                                      â”‚
â”‚           â”‚ (ä»‹å…¥è§£é‡ˆ)  â”‚                                      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                 â”‚                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚    â–¼            â”‚            â–¼                                 â”‚
â”‚ ã€Œã‚„ãªã«ä¼é”ã€   â”‚      ã€Œé€†è³ªå•ç”Ÿæˆã€                          â”‚
â”‚                 â”‚       ã€Œå…·ä½“çš„ã«ã¯ï¼Ÿã€                        â”‚
â”‚                 â”‚            â”‚                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                 â”‚ [Resume]   â”‚                                 â”‚
â”‚                 â–¼            â–¼                                 â”‚
â”‚  ã€é€šå¸¸çŠ¶æ…‹: RUNNINGã€‘  ã€ä»‹å…¥çŠ¶æ…‹: QUERY_BACKã€‘               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. çŠ¶æ…‹é·ç§»

### 3.1 çŠ¶æ…‹ä¸€è¦§

```python
class InterventionState(Enum):
    """ä»‹å…¥çŠ¶æ…‹"""
    RUNNING = "running"           # é€šå¸¸é‹è»¢ï¼ˆå¯¾è©±ç¶™ç¶šä¸­ï¼‰
    PAUSED = "paused"             # ä¸€æ™‚åœæ­¢ï¼ˆå…¥åŠ›å¾…ã¡ï¼‰
    PROCESSING = "processing"     # æŒ‡ç¤ºè§£é‡ˆä¸­
    QUERY_BACK = "query_back"     # ã‚­ãƒ£ãƒ©ã‹ã‚‰ã®é€†è³ªå•å¾…ã¡
    RESUMING = "resuming"         # å†é–‹æº–å‚™ä¸­
```

### 3.2 çŠ¶æ…‹é·ç§»å›³

```
                    [Start]
                       â”‚
                       â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”Œâ”€â”€â”€â”€â”€â”€â”‚ RUNNING â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
         â”‚           â”‚                       â”‚
         â”‚    [Pause Button]                 â”‚
         â”‚           â”‚                       â”‚
         â”‚           â–¼                       â”‚
         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
         â”‚      â”‚ PAUSED  â”‚                  â”‚
         â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
         â”‚           â”‚                       â”‚
         â”‚     [Send Message]                â”‚
         â”‚           â”‚                       â”‚
         â”‚           â–¼                       â”‚
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
         â”‚    â”‚ PROCESSING â”‚                 â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
         â”‚           â”‚                       â”‚
         â”‚     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                â”‚
         â”‚     â”‚           â”‚                â”‚
         â”‚     â–¼           â–¼                â”‚
         â”‚  [æŒ‡ç¤ºOK]   [è¦ç¢ºèª]              â”‚
         â”‚     â”‚           â”‚                â”‚
         â”‚     â”‚           â–¼                â”‚
         â”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
         â”‚     â”‚    â”‚ QUERY_BACK â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚     â”‚           â”‚                â”‚
         â”‚     â”‚     [Answer]               â”‚
         â”‚     â”‚           â”‚                â”‚
         â”‚     â”‚           â–¼                â”‚
         â”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
         â”‚     â””â”€â”€â”€â–¶â”‚ RESUMING   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    [Stop Button]
         â”‚
         â–¼
      [End]
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 4.1 InterventionSession

```python
@dataclass
class InterventionSession:
    """ä»‹å…¥ã‚»ãƒƒã‚·ãƒ§ãƒ³"""
    session_id: str                      # UUID
    run_id: str                          # é–¢é€£ã™ã‚‹run_id
    state: InterventionState             # ç¾åœ¨ã®çŠ¶æ…‹
    created_at: str                      # ä½œæˆæ—¥æ™‚
    
    # å…¥åŠ›å±¥æ­´
    owner_messages: List[OwnerMessage]   # ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    
    # ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼è§£é‡ˆçµæœ
    interpretation: Optional[InterventionInterpretation]
    
    # ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å¿œç­”
    character_responses: List[CharacterResponse]
    
    # é€†è³ªå•
    query_back: Optional[QueryBack]
```

### 4.2 OwnerMessage

```python
@dataclass
class OwnerMessage:
    """ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"""
    message_id: str
    content: str                         # ã‚ªãƒ¼ãƒŠãƒ¼ã®å…¥åŠ›å†…å®¹
    timestamp: str
    message_type: str                    # "instruction" | "answer" | "clarification"
```

### 4.3 InterventionInterpretation

```python
@dataclass
class InterventionInterpretation:
    """ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ã«ã‚ˆã‚‹ä»‹å…¥è§£é‡ˆ"""
    target_character: Optional[str]      # "yana" | "ayu" | "both" | None
    instruction_type: str                # æŒ‡ç¤ºã‚¿ã‚¤ãƒ—
    instruction_content: str             # ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¸ã®æŒ‡ç¤ºå†…å®¹
    needs_clarification: bool            # ç¢ºèªãŒå¿…è¦ã‹
    clarification_question: Optional[str]  # ç¢ºèªã®è³ªå•
    confidence: float                    # è§£é‡ˆã®ç¢ºä¿¡åº¦ (0.0-1.0)
```

### 4.4 æŒ‡ç¤ºã‚¿ã‚¤ãƒ—

```python
class InstructionType(Enum):
    """æŒ‡ç¤ºã‚¿ã‚¤ãƒ—"""
    TOPIC_CHANGE = "topic_change"        # è©±é¡Œå¤‰æ›´
    TOPIC_DEEPEN = "topic_deepen"        # è©±é¡Œæ·±æ˜ã‚Š
    INFO_SUPPLEMENT = "info_supplement"  # æƒ…å ±è£œè¶³
    MOOD_CHANGE = "mood_change"          # é›°å›²æ°—å¤‰æ›´
    CHARACTER_FOCUS = "character_focus"  # ã‚­ãƒ£ãƒ©æŒ‡å
    GENERAL = "general"                  # ä¸€èˆ¬çš„ãªæŒ‡ç¤º
```

### 4.5 QueryBack

```python
@dataclass
class QueryBack:
    """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‹ã‚‰ã®é€†è³ªå•"""
    from_character: str                  # "yana" | "ayu"
    question: str                        # è³ªå•å†…å®¹
    context: str                         # è³ªå•ã®èƒŒæ™¯
    options: Optional[List[str]]         # é¸æŠè‚¢ï¼ˆã‚ã‚Œã°ï¼‰
```

---

## 5. ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼æ‹¡å¼µ

### 5.1 ä»‹å…¥è§£é‡ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```yaml
# persona/director/intervention_prompt.yaml

system: |
  ã‚ãªãŸã¯ã€Œã‚„ãªã€ã¨ã€Œã‚ã‚†ã€ã®å¯¾è©±ã‚’ç›£ç£ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚
  ã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆè£½ä½œè€…ï¼‰ã‹ã‚‰ã®ä»‹å…¥æŒ‡ç¤ºã‚’è§£é‡ˆã—ã€é©åˆ‡ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«ä¼ãˆã¾ã™ã€‚
  
  ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç‰¹æ€§ã€‘
  - ã‚„ãªï¼ˆå§‰/Edge AIï¼‰: ç›´æ„Ÿçš„ã€è¡Œå‹•æ´¾ã€æ„Ÿè¦šé‡è¦–
  - ã‚ã‚†ï¼ˆå¦¹/Cloud AIï¼‰: åˆ†æçš„ã€æ…é‡æ´¾ã€ãƒ‡ãƒ¼ã‚¿é‡è¦–
  
  ã€è§£é‡ˆãƒ«ãƒ¼ãƒ«ã€‘
  1. æŒ‡ç¤ºã®æ„å›³ã‚’ç†è§£ã™ã‚‹
  2. é©åˆ‡ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸ã¶ï¼ˆã¾ãŸã¯ä¸¡æ–¹ï¼‰
  3. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒç†è§£ã§ãã‚‹è¨€è‘‰ã«å¤‰æ›ã™ã‚‹
  4. å¿…è¦ãªã‚‰ç¢ºèªã®è³ªå•ã‚’ç”Ÿæˆã™ã‚‹

interpretation_template: |
  ã€ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã‚‰ã®æŒ‡ç¤ºã€‘
  {owner_message}
  
  ã€ç¾åœ¨ã®å¯¾è©±çŠ¶æ³ã€‘
  æœ€è¿‘ã®ç™ºè¨€:
  {recent_dialogue}
  
  ã€åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‘
  1. ã“ã®æŒ‡ç¤ºã¯èª°ã«ä¼ãˆã‚‹ã¹ãã‹ï¼Ÿï¼ˆyana / ayu / bothï¼‰
  2. ã©ã®ã‚ˆã†ãªæŒ‡ç¤ºã‚¿ã‚¤ãƒ—ã‹ï¼Ÿ
  3. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«ã©ã†ä¼ãˆã‚‹ã‹ï¼Ÿ
  4. ç¢ºèªãŒå¿…è¦ãªç‚¹ã¯ã‚ã‚‹ã‹ï¼Ÿ
  
  JSONå½¢å¼ã§å›ç­”:
  {
    "target_character": "yana" | "ayu" | "both",
    "instruction_type": "topic_change" | "topic_deepen" | "info_supplement" | "mood_change" | "character_focus" | "general",
    "instruction_content": "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¸ã®æŒ‡ç¤ºæ–‡",
    "needs_clarification": true | false,
    "clarification_question": "ç¢ºèªã®è³ªå•ï¼ˆå¿…è¦ãªå ´åˆï¼‰",
    "confidence": 0.0-1.0
  }
```

### 5.2 é€†è³ªå•ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```yaml
# persona/director/query_back_prompt.yaml

system: |
  ã‚ªãƒ¼ãƒŠãƒ¼ã®æŒ‡ç¤ºãŒæ›–æ˜§ãªå ´åˆã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è¦–ç‚¹ã§ç¢ºèªã®è³ªå•ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
  è³ªå•ã¯ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å£èª¿ã§è¡Œã„ã¾ã™ã€‚

query_template: |
  ã€ã‚ªãƒ¼ãƒŠãƒ¼ã®æŒ‡ç¤ºã€‘
  {owner_message}
  
  ã€æ›–æ˜§ãªç‚¹ã€‘
  {ambiguity}
  
  ã€è³ªå•ã™ã‚‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€‘
  {character}
  
  ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å£èª¿ã§ã€ã‚ªãƒ¼ãƒŠãƒ¼ã«ç¢ºèªã®è³ªå•ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„:
```

---

## 6. UIè¨­è¨ˆ

### 6.1 OwnerControlPanel ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›ï¸ Owner Control                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Status: [ğŸŸ¢ RUNNING / â¸ï¸ PAUSED]       â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [â¸ï¸ Pause] [â–¶ï¸ Resume] [â¹ï¸ Stop] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                         â”‚
â”‚  ğŸ“ Intervention Message:               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚  (placeholder: æŒ‡ç¤ºã‚’å…¥åŠ›...)    â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  [ğŸ“¤ Send Instruction]                  â”‚
â”‚                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                         â”‚
â”‚  ğŸ“œ Intervention Log:                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 12:34 [Owner] ã‚«ãƒ¼ãƒ–ã®è©±ã«æˆ»ã—ã¦ â”‚   â”‚
â”‚  â”‚ 12:34 [Director] â†’ ã‚„ãªã«ä¼é”   â”‚   â”‚
â”‚  â”‚ 12:35 [ã‚„ãª] äº†è§£ï¼ã‚«ãƒ¼ãƒ–ã­...   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 é€†è³ªå•ãƒ¢ãƒ¼ãƒ€ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‹ã‚‰ã®è³ªå•                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ‘§ ã‚„ãª:                                           â”‚
â”‚  ã€Œã‚«ãƒ¼ãƒ–ã®è©±ã£ã¦ã€ã•ã£ãã®å³ã‚«ãƒ¼ãƒ–ã®ã“ã¨ï¼Ÿ         â”‚
â”‚   ãã‚Œã¨ã‚‚å…¨èˆ¬çš„ã«ã‚«ãƒ¼ãƒ–æ”»ç•¥ã®è©±ï¼Ÿã€                â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                               â”‚ â”‚
â”‚  â”‚  (placeholder: å›ç­”ã‚’å…¥åŠ›...)                  â”‚ â”‚
â”‚  â”‚                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚  Quick Answers:                                     â”‚
â”‚  [ã•ã£ãã®å³ã‚«ãƒ¼ãƒ–] [ã‚«ãƒ¼ãƒ–å…¨èˆ¬] [ã©ã£ã¡ã§ã‚‚ã„ã„]   â”‚
â”‚                                                     â”‚
â”‚                           [ğŸ“¤ Answer] [âŒ Cancel]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä¸Šã®ä»‹å…¥è¡¨ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Timeline                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ‘§ ã‚„ãª: ã‚ã€ã‚»ãƒ³ã‚µãƒ¼ã®å€¤ãŒå¤‰ã ...               â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ‘§ ã‚ã‚†: ã©ã®ã‚»ãƒ³ã‚µãƒ¼ã§ã™ã‹ï¼Ÿ                     â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ”” OWNER INTERVENTION                              â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚ â”‚ â”‚ ğŸ“ ã€Œã‚«ãƒ¼ãƒ–ã®è©±ã«æˆ»ã—ã¦ã€                      â”‚â”‚â”‚
â”‚ â”‚ â”‚ âœ Director: ã‚„ãªã«ä¼é”                        â”‚â”‚â”‚
â”‚ â”‚ â”‚    ã€Œã‚ªãƒ¼ãƒŠãƒ¼ãŒã‚«ãƒ¼ãƒ–ã®è©±ã‚’èããŸã„ãã†ã§ã™ã€  â”‚â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ‘§ ã‚„ãª: ã‚ã€ãã†ã ã£ãŸï¼ã‚«ãƒ¼ãƒ–ã®è©±ã­...         â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### 7.1 æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```
# çŠ¶æ…‹ç®¡ç†
GET  /api/v2/intervention/status
     â†’ ç¾åœ¨ã®ä»‹å…¥çŠ¶æ…‹ã‚’å–å¾—

POST /api/v2/intervention/pause
     â†’ å¯¾è©±ã‚’ä¸€æ™‚åœæ­¢

POST /api/v2/intervention/resume
     â†’ å¯¾è©±ã‚’å†é–‹

# ä»‹å…¥æ“ä½œ
POST /api/v2/intervention/send
     {message: string, type?: string}
     â†’ ã‚ªãƒ¼ãƒŠãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡

POST /api/v2/intervention/answer
     {answer: string}
     â†’ é€†è³ªå•ã«å›ç­”

# ãƒ­ã‚°
GET  /api/v2/intervention/log
     ?run_id=xxx
     â†’ ä»‹å…¥ãƒ­ã‚°ã‚’å–å¾—

# SSEã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆæ—¢å­˜ã®æ‹¡å¼µï¼‰
GET  /api/v2/intervention/stream
     â†’ ä»‹å…¥ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡
```

### 7.2 SSEã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—

```typescript
type InterventionEvent = 
  | { type: "state_change", state: InterventionState }
  | { type: "owner_message", message: OwnerMessage }
  | { type: "interpretation", interpretation: InterventionInterpretation }
  | { type: "query_back", query: QueryBack }
  | { type: "character_response", response: CharacterResponse }
  | { type: "resume", next_speaker: string }
```

---

## 8. ã‚¯ãƒ©ã‚¹è¨­è¨ˆ

### 8.1 InterventionManager

```python
class InterventionManager:
    """ã‚ªãƒ¼ãƒŠãƒ¼ä»‹å…¥ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼"""
    
    def __init__(
        self,
        director: Director,
        char_a: Character,
        char_b: Character
    ):
        self.director = director
        self.char_a = char_a
        self.char_b = char_b
        self.current_session: Optional[InterventionSession] = None
        self.state = InterventionState.RUNNING
    
    # === çŠ¶æ…‹ç®¡ç† ===
    def pause(self, run_id: str) -> InterventionSession:
        """å¯¾è©±ã‚’ä¸€æ™‚åœæ­¢ã—ã¦ä»‹å…¥ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹"""
        pass
    
    def resume(self) -> bool:
        """å¯¾è©±ã‚’å†é–‹"""
        pass
    
    def get_state(self) -> InterventionState:
        """ç¾åœ¨ã®çŠ¶æ…‹ã‚’å–å¾—"""
        pass
    
    # === ä»‹å…¥å‡¦ç† ===
    def process_owner_message(
        self,
        message: str,
        message_type: str = "instruction"
    ) -> InterventionResult:
        """
        ã‚ªãƒ¼ãƒŠãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†
        
        Returns:
            InterventionResult: å‡¦ç†çµæœ
            - success: æˆåŠŸã—ãŸã‹
            - needs_clarification: ç¢ºèªãŒå¿…è¦ã‹
            - query_back: é€†è³ªå•ï¼ˆå¿…è¦ãªå ´åˆï¼‰
            - next_action: æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
        """
        pass
    
    def answer_query_back(self, answer: str) -> InterventionResult:
        """é€†è³ªå•ã«å›ç­”"""
        pass
    
    # === ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼é€£æº ===
    def _interpret_instruction(
        self,
        message: str,
        context: Dict
    ) -> InterventionInterpretation:
        """ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ã«æŒ‡ç¤ºã‚’è§£é‡ˆã•ã›ã‚‹"""
        pass
    
    def _generate_query_back(
        self,
        ambiguity: str,
        character: str
    ) -> QueryBack:
        """é€†è³ªå•ã‚’ç”Ÿæˆ"""
        pass
    
    def _apply_instruction(
        self,
        interpretation: InterventionInterpretation
    ) -> CharacterResponse:
        """æŒ‡ç¤ºã‚’ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«é©ç”¨"""
        pass
```

### 8.2 InterventionResult

```python
@dataclass
class InterventionResult:
    """ä»‹å…¥å‡¦ç†çµæœ"""
    success: bool
    state: InterventionState
    needs_clarification: bool
    query_back: Optional[QueryBack]
    character_response: Optional[CharacterResponse]
    next_action: str  # "wait_input" | "wait_answer" | "resume" | "continue"
    error: Optional[str]
```

---

## 9. å¯¾è©±ã¸ã®çµ±åˆ

### 9.1 ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—å¤‰æ›´

```python
# scripts/run_jetracer_live.py ã®å¤‰æ›´

class LiveCommentarySession:
    def __init__(self, ...):
        # æ—¢å­˜ã®åˆæœŸåŒ–
        ...
        # ä»‹å…¥ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼è¿½åŠ 
        self.intervention = InterventionManager(
            director=self.director,
            char_a=self.char_a,
            char_b=self.char_b
        )
    
    def run_frame(self) -> bool:
        # ä»‹å…¥çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
        if self.intervention.state != InterventionState.RUNNING:
            # ä»‹å…¥ä¸­ã¯å¯¾è©±ã‚’ç”Ÿæˆã—ãªã„
            return self._handle_intervention()
        
        # é€šå¸¸ã®å¯¾è©±ç”Ÿæˆ
        ...
    
    def _handle_intervention(self) -> bool:
        """ä»‹å…¥çŠ¶æ…‹ã®å‡¦ç†"""
        state = self.intervention.state
        
        if state == InterventionState.PAUSED:
            # å…¥åŠ›å¾…ã¡
            print("â¸ï¸ Waiting for owner input...")
            return True
        
        elif state == InterventionState.QUERY_BACK:
            # é€†è³ªå•è¡¨ç¤º
            query = self.intervention.current_session.query_back
            print(f"ğŸ’¬ {query.from_character}: {query.question}")
            return True
        
        elif state == InterventionState.RESUMING:
            # å†é–‹å‡¦ç†
            return self._resume_dialogue()
        
        return True
```

### 9.2 ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¸ã®æŒ‡ç¤ºæ³¨å…¥

```python
# src/character.py ã®å¤‰æ›´

def speak_v2(
    self,
    ...,
    owner_instruction: Optional[str] = None  # æ–°è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
):
    """v2.1 ç™ºè©±ç”Ÿæˆï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ä»‹å…¥å¯¾å¿œï¼‰"""
    
    builder = PromptBuilder()
    
    # ... æ—¢å­˜ã®æ³¨å…¥ ...
    
    # ã‚ªãƒ¼ãƒŠãƒ¼æŒ‡ç¤ºã®æ³¨å…¥ï¼ˆæœ€é«˜å„ªå…ˆåº¦ï¼‰
    if owner_instruction:
        builder.add(
            f"ã€ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã‚‰ã®æŒ‡ç¤ºã€‘\n{owner_instruction}\n"
            "ã“ã®æŒ‡ç¤ºã‚’è‡ªç„¶ã«å¯¾è©±ã«åæ˜ ã—ã¦ãã ã•ã„ã€‚",
            priority=Priority.OWNER_INSTRUCTION,  # æ–°è¦: æœ€é«˜å„ªå…ˆåº¦
            source="owner_intervention"
        )
```

---

## 10. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

### 10.1 config/intervention_settings.yaml

```yaml
intervention:
  # åŸºæœ¬è¨­å®š
  enabled: true
  max_session_duration_minutes: 30
  
  # é€†è³ªå•è¨­å®š
  query_back:
    enabled: true
    confidence_threshold: 0.7  # ã“ã®ç¢ºä¿¡åº¦ä»¥ä¸‹ã§é€†è³ªå•
    max_queries_per_session: 3
  
  # è‡ªå‹•å†é–‹è¨­å®š
  auto_resume:
    enabled: false
    timeout_seconds: 60
  
  # UIè¨­å®š
  ui:
    show_interpretation: true   # ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ã®è§£é‡ˆã‚’è¡¨ç¤º
    show_confidence: false      # ç¢ºä¿¡åº¦ã‚’è¡¨ç¤º
    quick_answers_enabled: true # ã‚¯ã‚¤ãƒƒã‚¯å›ç­”ãƒœã‚¿ãƒ³
```

---

## 11. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 11.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```python
# tests/test_intervention.py

class TestInterventionManager:
    def test_pause_creates_session(self):
        """pauseã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã‚‹ã‹"""
        pass
    
    def test_process_simple_instruction(self):
        """ã‚·ãƒ³ãƒ—ãƒ«ãªæŒ‡ç¤ºãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã‚‹ã‹"""
        pass
    
    def test_query_back_on_ambiguous(self):
        """æ›–æ˜§ãªæŒ‡ç¤ºã§é€†è³ªå•ãŒç”Ÿæˆã•ã‚Œã‚‹ã‹"""
        pass
    
    def test_answer_query_back(self):
        """é€†è³ªå•ã¸ã®å›ç­”ãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã‚‹ã‹"""
        pass
    
    def test_resume_restores_state(self):
        """resumeã§çŠ¶æ…‹ãŒæ­£ã—ãå¾©å…ƒã•ã‚Œã‚‹ã‹"""
        pass

class TestDirectorInterpretation:
    def test_topic_change_interpretation(self):
        """è©±é¡Œå¤‰æ›´æŒ‡ç¤ºã®è§£é‡ˆ"""
        pass
    
    def test_character_selection(self):
        """é©åˆ‡ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ"""
        pass
```

### 11.2 çµ±åˆãƒ†ã‚¹ãƒˆ

```python
# tests/test_intervention_integration.py

class TestInterventionIntegration:
    def test_full_intervention_flow(self):
        """ä»‹å…¥ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®ãƒ†ã‚¹ãƒˆ"""
        # 1. å¯¾è©±é–‹å§‹
        # 2. Pause
        # 3. Send instruction
        # 4. Resume
        # 5. å¯¾è©±ãŒæŒ‡ç¤ºã‚’åæ˜ ã—ã¦ã„ã‚‹ã‹ç¢ºèª
        pass
    
    def test_query_back_flow(self):
        """é€†è³ªå•ãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ"""
        pass
```

---

## 12. å®Ÿè£…å„ªå…ˆé †ä½

| é †åº | å†…å®¹ | ä¾å­˜ |
|------|------|------|
| 1 | InterventionManageråŸºæœ¬ã‚¯ãƒ©ã‚¹ | ãªã— |
| 2 | çŠ¶æ…‹é·ç§»ï¼ˆPause/Resumeï¼‰ | 1 |
| 3 | ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ä»‹å…¥è§£é‡ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ | 1 |
| 4 | ã‚·ãƒ³ãƒ—ãƒ«ãªæŒ‡ç¤ºå‡¦ç† | 2, 3 |
| 5 | APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | 1-4 |
| 6 | OwnerControlPanel UI | 5 |
| 7 | é€†è³ªå•æ©Ÿèƒ½ | 4 |
| 8 | é€†è³ªå•UIï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰ | 6, 7 |
| 9 | ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä»‹å…¥è¡¨ç¤º | 6 |
